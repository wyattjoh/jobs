

# jobs
`import "github.com/wyattjoh/jobs"`

* [Overview](#pkg-overview)
* [Index](#pkg-index)

## <a name="pkg-overview">Overview</a>
Package jobs is a simple implementation of a job queue using redis's powerful
RPOPLPUSH command to ensure reliable completion of jobs.

Currently not implemented but planned is functions to access the failed list
and a way to mark a job as failed and to stop retrying.




## <a name="pkg-index">Index</a>
* [Constants](#pkg-constants)
* [Variables](#pkg-variables)
* [func Pull(ctx context.Context, con redis.Conn, name string, work func(context.Context, Message) error) error](#Pull)
* [func Push(ctx context.Context, con redis.Conn, name string, payload interface{}) (string, error)](#Push)
* [type JobStats](#JobStats)
  * [func Stats(ctx context.Context, con redis.Conn, name string) (*JobStats, error)](#Stats)
* [type Message](#Message)
  * [func (m Message) Unmarshal(dst interface{}) error](#Message.Unmarshal)


#### <a name="pkg-files">Package files</a>
[jobs.go](/src/github.com/wyattjoh/jobs/jobs.go) 


## <a name="pkg-constants">Constants</a>
``` go
const (

    // ActiveListFormat is the format used to indicate active jobs.
    ActiveListFormat = "jobs:%s:active"

    // ProcessingListFormat is the format for the list to indicate processing
    // jobs.
    ProcessingListFormat = "jobs:%s:processing"

    // FailedListFormat is a list containing failed jobs that have exceeded the
    // failure attempts.
    FailedListFormat = "jobs:%s:failed"

    // JobFormat is the details for a specific job stored in a hash set. This is
    // cleared when the job has been sucesfully processed.
    JobFormat = "jobs:%s:job:%s"
)
```

## <a name="pkg-variables">Variables</a>
``` go
var (

    // ErrEmpty is returned when there is no job to pull.
    ErrEmpty = errors.New("there was no job to pull")
)
```
``` go
var (

    // MaxAttempts declares how many times that a job can be retried before it is
    // considered failed.
    MaxAttempts = 5
)
```


## <a name="Pull">func</a> [Pull](/src/target/jobs.go?s=4975:5083#L174)
``` go
func Pull(ctx context.Context, con redis.Conn, name string, work func(context.Context, Message) error) error
```
Pull will try to get the next job to process, an will return with an ErrEmpty
if there was no job to pull. The work function provided will get a copy of
the message being processed, and upon sucesfull return from that function
it will mark the message as processed. If the work function return an error,
that message will be re-added to the active queue for a maximum of
MaxAttempts times at which point it will be placed into the Failed list.



## <a name="Push">func</a> [Push](/src/target/jobs.go?s=1827:1923#L58)
``` go
func Push(ctx context.Context, con redis.Conn, name string, payload interface{}) (string, error)
```
Push will marshal the incoming payload and create a Message for it. It will
then push that into the active list to be pulled on subsequent Pull's. It
will return the Message ID for tracing.




## <a name="JobStats">type</a> [JobStats](/src/target/jobs.go?s=6742:6814#L231)
``` go
type JobStats struct {
    Processing int
    Failed     int
    Active     int
}
```
JobStats contains the statistics for the current job name.







### <a name="Stats">func</a> [Stats](/src/target/jobs.go?s=6868:6947#L238)
``` go
func Stats(ctx context.Context, con redis.Conn, name string) (*JobStats, error)
```
Stats returns the JobStats for a given job name.





## <a name="Message">type</a> [Message](/src/target/jobs.go?s=600:713#L15)
``` go
type Message struct {
    ID       string
    Data     []byte
    Name     string `json:"-"`
    Attempts int    `json:"-"`
}
```
Message is used to encapsulate the job's data.s










### <a name="Message.Unmarshal">func</a> (Message) [Unmarshal](/src/target/jobs.go?s=767:816#L23)
``` go
func (m Message) Unmarshal(dst interface{}) error
```
Unmarshal extracts the payload from the Message.








- - -
Generated by [godoc2md](http://godoc.org/github.com/davecheney/godoc2md)
